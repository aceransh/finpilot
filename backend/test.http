@host = http://localhost:8080
@json = application/json

### 1) List rules as DEMO (expected: maybe empty or whatever youâ€™ve made before)
GET {{host}}/api/v1/rules
Accept: {{json}}

### 2) List rules as ALICE (expected: empty initially)
GET {{host}}/api/v1/rules
Accept: {{json}}
X-Demo-User: alice

### 3) Create a category for ALICE (needed to attach to a rule)
POST {{host}}/api/v1/categories
Accept: {{json}}
Content-Type: {{json}}
X-Demo-User: alice

{
  "name": "Coffee",
  "type": "EXPENSE",
  "color": "#795548"
}

### 4) List ALICE categories, copy the "id" of Coffee into {{aliceCoffeeCatId}} below
GET {{host}}/api/v1/categories
Accept: {{json}}
X-Demo-User: alice

### 5) Create a CONTAINS rule for ALICE (pattern: "starbucks")
# Replace the placeholder with the Coffee category id you copied
@aliceCoffeeCatId = 4aed0109-54b2-4f8d-94f6-add8518ec1f0

POST {{host}}/api/v1/rules
Accept: {{json}}
Content-Type: {{json}}
X-Demo-User: alice

{
  "pattern": "starbucks",
  "matchType": "CONTAINS",
  "categoryId": "{{aliceCoffeeCatId}}",
  "priority": 50,
  "enabled": true
}

### 6) Verify ALICE rules show the new rule
GET {{host}}/api/v1/rules
Accept: {{json}}
X-Demo-User: alice

### 7) Test the rule matcher as ALICE (should match)
POST {{host}}/api/v1/rules/test
Accept: {{json}}
Content-Type: {{json}}
X-Demo-User: alice

{ "merchant": "STARBUCKS #123" }

### 8) Create a tx as ALICE that should auto-categorize via the rule
POST {{host}}/api/v1/transactions
Accept: {{json}}
Content-Type: {{json}}
X-Demo-User: alice

{
  "date": "2025-08-12",
  "amount": -6.50,
  "merchant": "Starbucks #456",
  "category": ""
}

### 9) List ALICE transactions and confirm the category is "Coffee"
GET {{host}}/api/v1/transactions?page=0&size=5&sort=date,desc
Accept: {{json}}
X-Demo-User: alice

### 10) Prove isolation: DEMO should NOT see ALICE rules
GET {{host}}/api/v1/rules
Accept: {{json}}

### 11) Prove matcher isolation: DEMO hitting /rules/test may return a different result or none
POST {{host}}/api/v1/rules/test
Accept: {{json}}
Content-Type: {{json}}

{ "merchant": "STARBUCKS #123" }